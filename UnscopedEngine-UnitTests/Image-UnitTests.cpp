#include "CppUnitTest.h"
#include"Helpers/MemoryLeakHelper.h"
#include"Graphics/Image.h"

using namespace Microsoft::VisualStudio::CppUnitTestFramework;

namespace ue
{
	TEST_CLASS(ImageUnitTests)
	{
	public:

		TEST_METHOD(LoadBitmapImageData_Test)
		{
			Image image1("Assets\\bitmap1.bmp", ImageType::BITMAP,ImageColorFormat::R8G8B8A8);
			image1.Init(0);

			unsigned char expected1[] = {
				0x10,0x40,0x20,0xFF, 0x18,0x30,0x48,0xFF, 0xFF,0xFF,0xFF,0xFF,
				0x50,0x20,0x60,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF, 0x08,0x10,0x80,0xFF
			};

			if ((image1.GetImageWidth() * image1.GetImageHeight()*4) != UINT(sizeof(expected1)))
			{
				Assert::Fail(L"Image1 test failed: different size.");
			}
			for (int i=0;i<sizeof(expected1);++i)
			{
				if (image1.GetImageData()[i] != expected1[i]) 
				{
					Assert::Fail(L"Image1 test failed: different value.");
				}
			}

			Image image2("Assets\\bitmap2.bmp", ImageType::BITMAP, ImageColorFormat::R8G8B8A8);
			image2.Init(0);

			unsigned char expected2[] = {
				0xFF,0xFF,0xFF,0xFF, 0x7D,0x0B,0x2D,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF,
				0xFF,0xC9,0x0E,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF,
				0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF, 0xFF,0xFF,0xFF,0xFF
			};

			if ((image2.GetImageWidth() * image2.GetImageHeight()*4) != UINT(sizeof(expected2)))
			{
				Assert::Fail(L"Image2 test failed: different size.");
			}
			for (int i = 0; i < sizeof(expected2); ++i)
			{
				if (image2.GetImageData()[i] != expected2[i])
				{
					Assert::Fail(L"Image2 test failed: different value.");
				}
			}

		}
	};
}
